name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  claude-review:
    name: Claude Code Review
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            You are reviewing a Go CLI project called zepctl. Focus on:

            ## Code Quality
            - Go best practices and idiomatic code
            - Error handling patterns
            - Security considerations
            - API design consistency
            - Test coverage recommendations

            ## Documentation Requirements
            When reviewing PRs that modify CLI commands, flags, or behavior in the `internal/` or `cmd/` directories:
            1. Check if the corresponding documentation in `docs/` is updated
            2. The `docs/` directory contains MDX help files that document CLI usage
            3. If a PR adds, removes, or modifies commands/flags/behavior, flag any missing documentation updates
            4. Verify that command examples in docs match the actual implementation
            5. Check that flag descriptions, defaults, and types are accurately documented

            If CLI functionality is changed but documentation is not updated, request the author to update the relevant docs.

            Use the repository's CLAUDE.md for guidance on style and conventions. Be constructive and helpful in your feedback.

            Use `gh pr comment` with your Bash tool to leave your review as a comment on the PR.

          claude_args: '--allowed-tools "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"'
